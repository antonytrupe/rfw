{"version":3,"sources":["../../src/common/Game.js"],"names":["PADDING","WIDTH","HEIGHT","PADDLE_WIDTH","PADDLE_HEIGHT","Paddle","gameEngine","options","props","health","other","Object","assign","type","BaseTypes","TYPES","INT16","DynamicObject","Ball","velocity","percent","Game","console","log","physicsEngine","SimplePhysicsEngine","on","gameLogic","bind","serverSideInit","serverSidePlayerJoined","serverSidePlayerDisconnected","clientSideInit","clientSideDraw","serializer","registerClass","paddles","world","queryObjects","instanceType","ball","queryObject","length","position","x","y","inputData","playerId","playerPaddle","input","addObjectToWorld","playerID","TwoVector","ev","controls","KeyboardControls","renderer","clientEngine","bindKey","repeat","updateEl","el","obj","style","top","left","background","toString","document","querySelector","GameEngine"],"mappings":";;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,OAAO,GAAG,EAAhB;AACA,IAAMC,KAAK,GAAG,GAAd;AACA,IAAMC,MAAM,GAAG,GAAf;AACA,IAAMC,YAAY,GAAG,EAArB;AACA,IAAMC,aAAa,GAAG,EAAtB,C,CAEA;;IACMC,M;;;;;AAEF,kBAAYC,UAAZ,EAAwBC,OAAxB,EAAiCC,KAAjC,EAAwC;AAAA;;AAAA;;AACpC,gFAAMF,UAAN,EAAkBC,OAAlB,EAA2BC,KAA3B;AACA,UAAKC,MAAL,GAAc,CAAd;AAFoC;AAGvC;;;;2BAQMC,K,EAAO;AACV,yEAAaA,KAAb;;AACA,WAAKD,MAAL,GAAcC,KAAK,CAACD,MAApB;AACH;;;wBATsB;AACnB,aAAOE,MAAM,CAACC,MAAP,CAAc;AACjBH,QAAAA,MAAM,EAAE;AAAEI,UAAAA,IAAI,EAAEC,mBAAUC,KAAV,CAAgBC;AAAxB;AADS,OAAd,mDAAP;AAGH;;;;EAXgBC,sB,GAmBrB;;;IACMC,I;;;;;AAEF,gBAAYZ,UAAZ,EAAwBC,OAAxB,EAAiCC,KAAjC,EAAwC;AAAA;;AAAA,6EAC9BF,UAD8B,EAClBC,OADkB,EACTC,KADS;AAEvC,G,CAED;;;;;2BAKOE,K,EAAO;AACV,uEAAaA,KAAb;AACH;;;wBANa;AACV,aAAO;AAAES,QAAAA,QAAQ,EAAE;AAAEC,UAAAA,OAAO,EAAE;AAAX;AAAZ,OAAP;AACH;;;;EATcH,sB;;IAgBEI,I;;;;;AAEjB,gBAAYd,OAAZ,EAAqB;AAAA;;AAAA;;AACjBe,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACA,+EAAMhB,OAAN;AACA,WAAKiB,aAAL,GAAqB,IAAIC,4BAAJ,CAAwB;AAAEnB,MAAAA,UAAU;AAAZ,KAAxB,CAArB,CAHiB,CAKjB;;AACA,WAAKoB,EAAL,CAAQ,UAAR,EAAoB,OAAKC,SAAL,CAAeC,IAAf,gCAApB,EANiB,CAQjB;;;AACA,WAAKF,EAAL,CAAQ,cAAR,EAAwB,OAAKG,cAAL,CAAoBD,IAApB,gCAAxB;;AACA,WAAKF,EAAL,CAAQ,sBAAR,EAAgC,OAAKI,sBAAL,CAA4BF,IAA5B,gCAAhC;;AACA,WAAKF,EAAL,CAAQ,4BAAR,EAAsC,OAAKK,4BAAL,CAAkCH,IAAlC,gCAAtC,EAXiB,CAajB;;;AACA,WAAKF,EAAL,CAAQ,uBAAR,EAAiC,OAAKM,cAAL,CAAoBJ,IAApB,gCAAjC;;AACA,WAAKF,EAAL,CAAQ,cAAR,EAAwB,OAAKO,cAAL,CAAoBL,IAApB,gCAAxB;;AAfiB;AAgBpB;;;;oCAEeM,U,EAAY;AACxBA,MAAAA,UAAU,CAACC,aAAX,CAAyB9B,MAAzB;AACA6B,MAAAA,UAAU,CAACC,aAAX,CAAyBjB,IAAzB;AACH;;;gCAEW;AACR,UAAIkB,OAAO,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAElC;AAAhB,OAAxB,CAAd;AACA,UAAImC,IAAI,GAAG,KAAKH,KAAL,CAAWI,WAAX,CAAuB;AAAEF,QAAAA,YAAY,EAAErB;AAAhB,OAAvB,CAAX;AACA,UAAI,CAACsB,IAAD,IAASJ,OAAO,CAACM,MAAR,KAAmB,CAAhC,EAAmC,OAH3B,CAKR;;AACA,UAAIF,IAAI,CAACG,QAAL,CAAcC,CAAd,IAAmB5C,OAAO,GAAGG,YAA7B,IACAqC,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmBT,OAAO,CAAC,CAAD,CAAP,CAAWS,CAD9B,IACmCL,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmBT,OAAO,CAAC,CAAD,CAAP,CAAWO,QAAX,CAAoBE,CAApB,GAAwBzC,aAD9E,IAEAoC,IAAI,CAACrB,QAAL,CAAcyB,CAAd,GAAkB,CAFtB,EAEyB;AAErB;AACAJ,QAAAA,IAAI,CAACrB,QAAL,CAAcyB,CAAd,IAAmB,CAAC,CAApB;AACAJ,QAAAA,IAAI,CAACG,QAAL,CAAcC,CAAd,GAAkB5C,OAAO,GAAGG,YAAV,GAAyB,CAA3C;AACH,OAPD,MAOO,IAAIqC,IAAI,CAACG,QAAL,CAAcC,CAAd,IAAmB,CAAvB,EAA0B;AAE7B;AACAJ,QAAAA,IAAI,CAACrB,QAAL,CAAcyB,CAAd,IAAmB,CAAC,CAApB;AACAJ,QAAAA,IAAI,CAACG,QAAL,CAAcC,CAAd,GAAkB,CAAlB;AACAtB,QAAAA,OAAO,CAACC,GAAR;AACAa,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAW3B,MAAX;AACH,OApBO,CAsBR;;;AACA,UAAI+B,IAAI,CAACG,QAAL,CAAcC,CAAd,IAAmB3C,KAAK,GAAGD,OAAR,GAAkBG,YAArC,IACAqC,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmBT,OAAO,CAAC,CAAD,CAAP,CAAWO,QAAX,CAAoBE,CADvC,IAC4CL,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmBT,OAAO,CAAC,CAAD,CAAP,CAAWO,QAAX,CAAoBE,CAApB,GAAwBzC,aADvF,IAEAoC,IAAI,CAACrB,QAAL,CAAcyB,CAAd,GAAkB,CAFtB,EAEyB;AAErB;AACAJ,QAAAA,IAAI,CAACrB,QAAL,CAAcyB,CAAd,IAAmB,CAAC,CAApB;AACAJ,QAAAA,IAAI,CAACG,QAAL,CAAcC,CAAd,GAAkB3C,KAAK,GAAGD,OAAR,GAAkBG,YAAlB,GAAiC,CAAnD;AACH,OAPD,MAOO,IAAIqC,IAAI,CAACG,QAAL,CAAcC,CAAd,IAAmB3C,KAAvB,EAA+B;AAElC;AACAuC,QAAAA,IAAI,CAACrB,QAAL,CAAcyB,CAAd,IAAmB,CAAC,CAApB;AACAJ,QAAAA,IAAI,CAACG,QAAL,CAAcC,CAAd,GAAkB3C,KAAK,GAAG,CAA1B;AACAqB,QAAAA,OAAO,CAACC,GAAR;AACAa,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAW3B,MAAX;AACH,OArCO,CAuCR;;;AACA,UAAI+B,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmB,CAAvB,EAA0B;AACtBL,QAAAA,IAAI,CAACG,QAAL,CAAcE,CAAd,GAAkB,CAAlB;AACAL,QAAAA,IAAI,CAACrB,QAAL,CAAc0B,CAAd,IAAmB,CAAC,CAApB;AACH,OAHD,MAGO,IAAIL,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmB3C,MAAvB,EAA+B;AAClCsC,QAAAA,IAAI,CAACG,QAAL,CAAcE,CAAd,GAAkB3C,MAAM,GAAG,CAA3B;AACAsC,QAAAA,IAAI,CAACrB,QAAL,CAAc0B,CAAd,IAAmB,CAAC,CAApB;AACH;AACJ;;;iCAEYC,S,EAAWC,Q,EAAU;AAC9B,6EAAmBD,SAAnB,EAA8BC,QAA9B,EAD8B,CAG9B;;;AACA,UAAIC,YAAY,GAAG,KAAKX,KAAL,CAAWI,WAAX,CAAuB;AAAEM,QAAAA,QAAQ,EAARA;AAAF,OAAvB,CAAnB;;AACA,UAAIC,YAAJ,EAAkB;AACd,YAAIF,SAAS,CAACG,KAAV,KAAoB,IAAxB,EAA8B;AAC1BD,UAAAA,YAAY,CAACL,QAAb,CAAsBE,CAAtB,IAA2B,CAA3B;AACH,SAFD,MAEO,IAAIC,SAAS,CAACG,KAAV,KAAoB,MAAxB,EAAgC;AACnCD,UAAAA,YAAY,CAACL,QAAb,CAAsBE,CAAtB,IAA2B,CAA3B;AACH;AACJ;AACJ,K,CAED;AACA;AACA;;;;qCACiB;AACb;AACA,WAAKK,gBAAL,CAAsB,IAAI7C,MAAJ,CAAW,IAAX,EAAiB,IAAjB,EAAuB;AAAE8C,QAAAA,QAAQ,EAAE,CAAZ;AAAeR,QAAAA,QAAQ,EAAE,IAAIS,kBAAJ,CAAcpD,OAAd,EAAuB,CAAvB;AAAzB,OAAvB,CAAtB;AACA,WAAKkD,gBAAL,CAAsB,IAAI7C,MAAJ,CAAW,IAAX,EAAiB,IAAjB,EAAuB;AAAE8C,QAAAA,QAAQ,EAAE,CAAZ;AAAeR,QAAAA,QAAQ,EAAE,IAAIS,kBAAJ,CAAcnD,KAAK,GAAGD,OAAtB,EAA+B,CAA/B;AAAzB,OAAvB,CAAtB;AACA,WAAKkD,gBAAL,CAAsB,IAAIhC,IAAJ,CAAS,IAAT,EAAe,IAAf,EAAqB;AACvCyB,QAAAA,QAAQ,EAAE,IAAIS,kBAAJ,CAAcnD,KAAK,GAAE,CAArB,EAAwBC,MAAM,GAAG,CAAjC,CAD6B;AAEvCiB,QAAAA,QAAQ,EAAE,IAAIiC,kBAAJ,CAAc,CAAd,EAAiB,CAAjB;AAF6B,OAArB,CAAtB;AAIH,K,CAED;;;;2CACuBC,E,EAAI;AACvB/B,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACA,UAAIa,OAAO,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAElC;AAAhB,OAAxB,CAAd;;AACA,UAAI+B,OAAO,CAAC,CAAD,CAAP,CAAWW,QAAX,KAAwB,CAA5B,EAA+B;AAC3BX,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWW,QAAX,GAAsBM,EAAE,CAACN,QAAzB;AACH,OAFD,MAEO,IAAIX,OAAO,CAAC,CAAD,CAAP,CAAWW,QAAX,KAAwB,CAA5B,EAA+B;AAClCX,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWW,QAAX,GAAsBM,EAAE,CAACN,QAAzB;AACH;AACJ;;;iDAE4BM,E,EAAI;AAC7B,UAAIjB,OAAO,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAElC;AAAhB,OAAxB,CAAd;;AACA,UAAI+B,OAAO,CAAC,CAAD,CAAP,CAAWW,QAAX,KAAwBM,EAAE,CAACN,QAA/B,EAAyC;AACrCX,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWW,QAAX,GAAsB,CAAtB;AACH,OAFD,MAEO,IAAIX,OAAO,CAAC,CAAD,CAAP,CAAWW,QAAX,KAAwBM,EAAE,CAACN,QAA/B,EAAyC;AAC5CX,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWW,QAAX,GAAsB,CAAtB;AACH;AACJ,K,CAED;AACA;AACA;;;;qCACiB;AACb,WAAKO,QAAL,GAAgB,IAAIC,yBAAJ,CAAqB,KAAKC,QAAL,CAAcC,YAAnC,CAAhB;AACA,WAAKH,QAAL,CAAcI,OAAd,CAAsB,IAAtB,EAA4B,IAA5B,EAAkC;AAAEC,QAAAA,MAAM,EAAE;AAAV,OAAlC;AACA,WAAKL,QAAL,CAAcI,OAAd,CAAsB,MAAtB,EAA8B,MAA9B,EAAsC;AAAEC,QAAAA,MAAM,EAAE;AAAV,OAAtC;AACH;;;qCAEgB;AAEb,eAASC,QAAT,CAAkBC,EAAlB,EAAsBC,GAAtB,EAA2B;AACvB,YAAIrD,MAAM,GAAGqD,GAAG,CAACrD,MAAJ,GAAW,CAAX,GAAaqD,GAAG,CAACrD,MAAjB,GAAwB,EAArC;AACAoD,QAAAA,EAAE,CAACE,KAAH,CAASC,GAAT,GAAeF,GAAG,CAACnB,QAAJ,CAAaE,CAAb,GAAiB,EAAjB,GAAsB,IAArC;AACAgB,QAAAA,EAAE,CAACE,KAAH,CAASE,IAAT,GAAgBH,GAAG,CAACnB,QAAJ,CAAaC,CAAb,GAAiB,IAAjC;AACAiB,QAAAA,EAAE,CAACE,KAAH,CAASG,UAAT,gBAA4BzD,MAAM,CAAC0D,QAAP,CAAgB,EAAhB,CAA5B,cAAmD1D,MAAM,CAAC0D,QAAP,CAAgB,EAAhB,CAAnD;AACH;;AAED,UAAI/B,OAAO,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAElC;AAAhB,OAAxB,CAAd;AACA,UAAImC,IAAI,GAAG,KAAKH,KAAL,CAAWI,WAAX,CAAuB;AAAEF,QAAAA,YAAY,EAAErB;AAAhB,OAAvB,CAAX;AACA,UAAI,CAACsB,IAAD,IAASJ,OAAO,CAACM,MAAR,KAAmB,CAAhC,EAAmC;AACnCkB,MAAAA,QAAQ,CAACQ,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAD,EAAkC7B,IAAlC,CAAR;AACAoB,MAAAA,QAAQ,CAACQ,QAAQ,CAACC,aAAT,CAAuB,UAAvB,CAAD,EAAqCjC,OAAO,CAAC,CAAD,CAA5C,CAAR;AACAwB,MAAAA,QAAQ,CAACQ,QAAQ,CAACC,aAAT,CAAuB,UAAvB,CAAD,EAAqCjC,OAAO,CAAC,CAAD,CAA5C,CAAR;AACH;;;;EAjJ6BkC,mB","sourcesContent":["import { GameEngine, BaseTypes, TwoVector, DynamicObject, KeyboardControls, SimplePhysicsEngine } from 'lance-gg';\r\n\r\nconst PADDING = 20;\r\nconst WIDTH = 400;\r\nconst HEIGHT = 400;\r\nconst PADDLE_WIDTH = 10;\r\nconst PADDLE_HEIGHT = 50;\r\n\r\n// A paddle has a health attribute\r\nclass Paddle extends DynamicObject {\r\n\r\n    constructor(gameEngine, options, props) {\r\n        super(gameEngine, options, props);\r\n        this.health = 0;\r\n    }\r\n\r\n    static get netScheme() {\r\n        return Object.assign({\r\n            health: { type: BaseTypes.TYPES.INT16 }\r\n        }, super.netScheme);\r\n    }\r\n\r\n    syncTo(other) {\r\n        super.syncTo(other);\r\n        this.health = other.health;\r\n    }\r\n}\r\n\r\n// a game object to represent the ball\r\nclass Ball extends DynamicObject {\r\n\r\n    constructor(gameEngine, options, props) {\r\n        super(gameEngine, options, props);\r\n    }\r\n\r\n    // avoid gradual synchronization of velocity\r\n    get bending() {\r\n        return { velocity: { percent: 0.0 } };\r\n    }\r\n\r\n    syncTo(other) {\r\n        super.syncTo(other);\r\n    }\r\n}\r\n\r\nexport default class Game extends GameEngine {\r\n\r\n    constructor(options) {\r\n        console.log('constructor')\r\n        super(options);\r\n        this.physicsEngine = new SimplePhysicsEngine({ gameEngine: this });\r\n\r\n        // common code\r\n        this.on('postStep', this.gameLogic.bind(this));\r\n\r\n        // server-only code\r\n        this.on('server__init', this.serverSideInit.bind(this));\r\n        this.on('server__playerJoined', this.serverSidePlayerJoined.bind(this));\r\n        this.on('server__playerDisconnected', this.serverSidePlayerDisconnected.bind(this));\r\n\r\n        // client-only code\r\n        this.on('client__rendererReady', this.clientSideInit.bind(this));\r\n        this.on('client__draw', this.clientSideDraw.bind(this));\r\n    }\r\n\r\n    registerClasses(serializer) {\r\n        serializer.registerClass(Paddle);\r\n        serializer.registerClass(Ball);\r\n    }\r\n\r\n    gameLogic() {\r\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\r\n        let ball = this.world.queryObject({ instanceType: Ball });\r\n        if (!ball || paddles.length !== 2) return;\r\n\r\n        // CHECK LEFT EDGE:\r\n        if (ball.position.x <= PADDING + PADDLE_WIDTH &&\r\n            ball.position.y >= paddles[0].y && ball.position.y <= paddles[0].position.y + PADDLE_HEIGHT &&\r\n            ball.velocity.x < 0) {\r\n\r\n            // ball moving left hit player 1 paddle\r\n            ball.velocity.x *= -1;\r\n            ball.position.x = PADDING + PADDLE_WIDTH + 1;\r\n        } else if (ball.position.x <= 0) {\r\n\r\n            // ball hit left wall\r\n            ball.velocity.x *= -1;\r\n            ball.position.x = 0;\r\n            console.log(`player 2 scored`);\r\n            paddles[0].health--;\r\n        }\r\n\r\n        // CHECK RIGHT EDGE:\r\n        if (ball.position.x >= WIDTH - PADDING - PADDLE_WIDTH &&\r\n            ball.position.y >= paddles[1].position.y && ball.position.y <= paddles[1].position.y + PADDLE_HEIGHT &&\r\n            ball.velocity.x > 0) {\r\n\r\n            // ball moving right hits player 2 paddle\r\n            ball.velocity.x *= -1;\r\n            ball.position.x = WIDTH - PADDING - PADDLE_WIDTH - 1;\r\n        } else if (ball.position.x >= WIDTH ) {\r\n\r\n            // ball hit right wall\r\n            ball.velocity.x *= -1;\r\n            ball.position.x = WIDTH - 1;\r\n            console.log(`player 1 scored`);\r\n            paddles[1].health--;\r\n        }\r\n\r\n        // ball hits top or bottom edge\r\n        if (ball.position.y <= 0) {\r\n            ball.position.y = 1;\r\n            ball.velocity.y *= -1;\r\n        } else if (ball.position.y >= HEIGHT) {\r\n            ball.position.y = HEIGHT - 1;\r\n            ball.velocity.y *= -1;\r\n        }\r\n    }\r\n\r\n    processInput(inputData, playerId) {\r\n        super.processInput(inputData, playerId);\r\n\r\n        // get the player paddle tied to the player socket\r\n        let playerPaddle = this.world.queryObject({ playerId });\r\n        if (playerPaddle) {\r\n            if (inputData.input === 'up') {\r\n                playerPaddle.position.y -= 5;\r\n            } else if (inputData.input === 'down') {\r\n                playerPaddle.position.y += 5;\r\n            }\r\n        }\r\n    }\r\n\r\n    //\r\n    // SERVER ONLY CODE\r\n    //\r\n    serverSideInit() {\r\n        // create the paddles and the ball\r\n        this.addObjectToWorld(new Paddle(this, null, { playerID: 0, position: new TwoVector(PADDING, 0) }));\r\n        this.addObjectToWorld(new Paddle(this, null, { playerID: 0, position: new TwoVector(WIDTH - PADDING, 0) }));\r\n        this.addObjectToWorld(new Ball(this, null, {\r\n            position: new TwoVector(WIDTH /2, HEIGHT / 2),\r\n            velocity: new TwoVector(2, 2)\r\n        }));\r\n    }\r\n\r\n    // attach newly connected player to next available paddle\r\n    serverSidePlayerJoined(ev) {\r\n        console.log('player connected')\r\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\r\n        if (paddles[0].playerId === 0) {\r\n            paddles[0].playerId = ev.playerId;\r\n        } else if (paddles[1].playerId === 0) {\r\n            paddles[1].playerId = ev.playerId;\r\n        }\r\n    }\r\n\r\n    serverSidePlayerDisconnected(ev) {\r\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\r\n        if (paddles[0].playerId === ev.playerId) {\r\n            paddles[0].playerId = 0;\r\n        } else if (paddles[1].playerId === ev.playerId) {\r\n            paddles[1].playerId = 0;\r\n        }\r\n    }\r\n\r\n    //\r\n    // CLIENT ONLY CODE\r\n    //\r\n    clientSideInit() {\r\n        this.controls = new KeyboardControls(this.renderer.clientEngine);\r\n        this.controls.bindKey('up', 'up', { repeat: true } );\r\n        this.controls.bindKey('down', 'down', { repeat: true } );\r\n    }\r\n\r\n    clientSideDraw() {\r\n\r\n        function updateEl(el, obj) {\r\n            let health = obj.health>0?obj.health:15;\r\n            el.style.top = obj.position.y + 10 + 'px';\r\n            el.style.left = obj.position.x + 'px';\r\n            el.style.background = `#ff${health.toString(16)}f${health.toString(16)}f`;\r\n        }\r\n\r\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\r\n        let ball = this.world.queryObject({ instanceType: Ball });\r\n        if (!ball || paddles.length !== 2) return;\r\n        updateEl(document.querySelector('.ball'), ball);\r\n        updateEl(document.querySelector('.paddle1'), paddles[0]);\r\n        updateEl(document.querySelector('.paddle2'), paddles[1]);\r\n    }\r\n}\r\n"],"file":"Game.js"}